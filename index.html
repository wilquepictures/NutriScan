<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="title">NutriScan</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 960px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .tab-button {
            padding: 10px 15px;
            border-radius: 8px;
            background-color: #e2e8f0;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.2s;
        }
        .tab-button.active {
            background-color: #4a5568;
            color: #ffffff;
        }
        .input-group label {
            font-weight: 600;
            color: #2d3748;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            margin-top: 5px;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 9999px;
            height: 24px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #48bb78;
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .net-calories-today {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .net-calories-today.text-red-600 {
            color: #e53e3e;
        }
        .net-calories-today.text-green-600 {
            color: #38a169;
        }
        #food-suggestions {
            position: absolute;
            background-color: white;
            border: 1px solid #cbd5e0;
            border-top: none;
            width: calc(100% - 2px);
            z-index: 10;
        }
        #food-suggestions div {
            padding: 10px;
            cursor: pointer;
        }
        #food-suggestions div:hover {
            background-color: #f7fafc;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            max-width: 400px;
            text-align: center;
        }
        .modal-message {
            margin-bottom: 16px;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 min-h-screen">
    <div class="container mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800" data-translate="title">NutriScan</h1>
            <p class="mt-2 text-gray-600 italic" data-translate="quote">"Your body can stand almost anything. It’s your mind that you have to convince"</p>
        </header>

        <div class="flex justify-center space-x-4 mb-8">
            <button class="tab-button active" data-tab="dashboard" data-translate="tab.dashboard">Dashboard</button>
            <button class="tab-button" data-tab="profile" data-translate="tab.profile">Profiel</button>
            <button class="tab-button" data-tab="calories" data-translate="tab.calories">Calorieën</button>
            <button class="tab-button" data-tab="fitness" data-translate="tab.fitness">Fitness</button>
            <button class="tab-button" data-tab="metingen" data-translate="tab.measurements">Metingen</button>
            <button class="tab-button" data-tab="history" data-translate="tab.history">Geschiedenis</button>
        </div>

        <main>
            <div id="dashboard" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="card p-6">
                        <h2 class="text-xl font-semibold mb-4" data-translate="dailyOverview">Overzicht Vandaag</h2>
                        <p class="text-gray-600 mb-2">
                            <span data-translate="consumed">Verbruikt: </span>
                            <span id="consumed-calories-display" class="font-bold">0 kcal</span>
                        </p>
                        <p class="text-gray-600 mb-2">
                            <span data-translate="burned">Verbrand: </span>
                            <span id="burned-calories-display" class="font-bold">0 kcal</span>
                        </p>
                        <hr class="my-3">
                        <p class="text-gray-800 font-bold text-lg">
                            <span data-translate="netCalories">Netto Calorieën: </span>
                            <span id="net-calories-display">0 kcal</span>
                        </p>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-xl font-semibold mb-4" data-translate="goalToday">Doel voor vandaag</h2>
                        <p class="text-gray-600 mb-2">
                            <span data-translate="yourDailyGoal">Jouw Dagelijks Doel:</span>
                            <span id="daily-goal-display" class="font-bold">0 kcal</span>
                        </p>
                        <p class="text-gray-600 mb-2">
                            <span data-translate="netCaloriesToday">Netto Calorieën:</span>
                            <span id="net-calories-today-display" class="font-bold">0 kcal</span>
                        </p>
                        <hr class="my-3">
                        <p class="text-gray-800 font-bold text-lg">
                            <span data-translate="caloriesRemaining">Calorieën Over:</span>
                            <span id="calories-remaining-display" class="font-calories-remaining">0 kcal</span>
                        </p>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-xl font-semibold mb-4" data-translate="weightProgress">Gewichtsvoortgang</h2>
                        <div class="space-y-2 mb-4">
                            <p id="current-weight-display" class="text-gray-600"><span data-translate="current">Huidig:</span> 0 kg</p>
                            <p id="target-weight-display" class="text-gray-600"><span data-translate="target">Doel:</span> 0 kg</p>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="progress-fill">
                                <span id="progress-text">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profile" class="tab-content hidden">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="personalInfo">Persoonlijke Gegevens</h2>
                    <form id="profile-form" class="space-y-4">
                        <div class="input-group">
                            <label for="language" data-translate="language">Taal</label>
                            <select id="language-select" name="language">
                                <option value="nl" data-translate="lang_nl">Nederlands</option>
                                <option value="fr" data-translate="lang_fr">Français</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="gender" data-translate="gender">Geslacht</label>
                            <select id="gender" name="gender" required>
                                <option value="" disabled selected>Selecteer...</option>
                                <option value="male" data-translate="male">Man</option>
                                <option value="female" data-translate="female">Vrouw</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="height" data-translate="height">Lengte (cm)</label>
                            <input type="number" id="height" name="height" min="50" max="250" required>
                        </div>
                        <div class="input-group">
                            <label for="age" data-translate="age">Leeftijd</label>
                            <input type="number" id="age" name="age" min="1" max="120" required>
                        </div>
                        <div class="input-group">
                            <label for="current-weight" data-translate="currentWeight">Huidig Gewicht (kg)</label>
                            <input type="number" id="current-weight" name="current-weight" step="0.1" min="20" required>
                        </div>
                        <div class="input-group">
                            <label for="target-weight" data-translate="targetWeight">Streefgewicht (kg)</label>
                            <input type="number" id="target-weight" name="target-weight" step="0.1" min="20" required>
                        </div>
                        <div class="input-group">
                            <label for="activity-factor" data-translate="activityFactor">Activiteitsfactor</label>
                            <select id="activity-factor" name="activity-factor" required>
                                <option value="1.2" data-translate="activity.sedentary">Zittend werk</option>
                                <option value="1.375" data-translate="activity.light">Licht actief (1-3x/week sport)</option>
                                <option value="1.55" data-translate="activity.moderate">Gemiddeld actief (3-5x/week sport)</option>
                                <option value="1.725" data-translate="activity.veryActive">Zeer actief (6-7x/week sport)</option>
                                <option value="1.9" data-translate="activity.extreme">Extreem actief (zwaar werk + 2x sport)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="weight-goal" data-translate="weightGoal">Wat zou u willen?</label>
                            <select id="weight-goal" name="weight-goal" required>
                                <option value="maintain" data-translate="maintainWeight">Gewicht behouden</option>
                                <option value="lose" data-translate="loseWeight">Gewicht verliezen</option>
                                <option value="gain" data-translate="gainWeight">Spieren opbouwen</option>
                            </select>
                        </div>
                        <button type="submit" class="bg-blue-500 text-white p-2 rounded w-full mt-4 hover:bg-blue-600" data-translate="saveAndCalculate">Opslaan & Berekenen</button>
                    </form>
                    <div class="mt-4">
                        <p class="text-gray-600 text-sm" data-translate="bmi">BMI</p>
                        <p class="text-xl font-bold" id="bmi-result">0.0</p>
                        <p class="text-gray-500" id="bmi-status"></p>
                    </div>
                    <div class="mt-4">
                        <p class="text-gray-600 text-sm" data-translate="dailyGoal">Dagelijks Doel (kcal)</p>
                        <p class="text-xl font-bold" id="daily-calorie-goal">0</p>
                    </div>
                    <div class="mt-4">
                        <p class="text-gray-600 text-sm" data-translate="timeToGoal">Haalbaar In (weken)</p>
                        <p class="text-xl font-bold" id="time-to-goal">0</p>
                    </div>
                </div>
            </div>

            <div id="calories" class="tab-content hidden">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="manualEntry">Handmatige Calorieën Registratie</h2>
                    <p class="text-gray-600 mb-4" data-translate="manualEntryText">Voer het voedingsmiddel en de details in om calorieën toe te voegen.</p>

                    <div class="space-y-4">
                        <div class="relative">
                            <label for="foodInput" class="block text-gray-700" data-translate="food">Voedingsmiddel</label>
                            <input type="text" id="foodInput" class="w-full p-2 border rounded" data-translate-placeholder="foodPlaceholder" placeholder="Bijv. banaan of water" autocomplete="off">
                            <div id="food-suggestions" class="hidden absolute top-full left-0 w-full bg-white border border-gray-300 rounded-b shadow-lg z-10"></div>
                        </div>

                        <div class="flex gap-4">
                            <div class="flex-1" id="grams-input-container">
                                <label for="gramsInput" class="block text-gray-700" data-translate="grams">Gewicht (in grammen)</label>
                                <input type="number" id="gramsInput" class="w-full p-2 border rounded" data-translate-placeholder="gramsPlaceholder" placeholder="Bijv. 120" min="1">
                            </div>
                            <div class="flex-1 hidden" id="liters-input-container">
                                <label for="litersInput" class="block text-gray-700" data-translate="liters">Gewicht (in liters)</label>
                                <input type="number" id="litersInput" class="w-full p-2 border rounded" data-translate-placeholder="litersPlaceholder" placeholder="Bijv. 0.5" step="0.1" min="0.1">
                            </div>

                            <div class="flex-1" id="cals-per-100g-container">
                                <label for="caloriesPer100gInput" class="block text-gray-700" data-translate="caloriesPer100g">Calorieën per 100g</label>
                                <input type="number" id="caloriesPer100gInput" class="w-full p-2 border rounded" data-translate-placeholder="caloriesPer100gPlaceholder" placeholder="Bijv. 89" min="1">
                            </div>
                            <div class="flex-1 hidden" id="cals-per-liter-container">
                                <label for="caloriesPerLiterInput" class="block text-gray-700" data-translate="caloriesPerLiter">Calorieën per 1L</label>
                                <input type="number" id="caloriesPerLiterInput" class="w-full p-2 border rounded" data-translate-placeholder="caloriesPerLiterPlaceholder" placeholder="Bijv. 40" min="1">
                            </div>
                        </div>

                        <button id="addCaloriesButton" class="bg-green-500 text-white p-2 rounded w-full hover:bg-green-600" data-translate="addCalories">Voeg Calorieën toe</button>
                    </div>
                </div>

                <div class="card p-6 mt-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="nutritionOverview">Overzicht Voeding</h2>
                    <p class="text-gray-600 mb-2" data-translate="today">Vandaag</p>
                    <p class="text-sm text-gray-500 mb-4" data-translate="noFoodAdded" id="no-food-text">Nog geen voedsel toegevoegd vandaag.</p>
                    <div class="table-container overflow-x-auto">
                        <table class="min-w-full bg-white border-collapse" id="daily-nutrition-overview">
                            <thead>
                                <tr class="bg-gray-200">
                                    <th class="py-2 px-4 border text-left" data-translate="date">Datum</th>
                                    <th class="py-2 px-4 border text-left" data-translate="food">Voedsel</th>
                                    <th class="py-2 px-4 border text-left" data-translate="weight-grams">Gewicht (g)</th>
                                    <th class="py-2 px-4 border text-left" data-translate="weight-liters">Gewicht (L)</th>
                                    <th class="py-2 px-4 border text-left" data-translate="calories">Calorieën</th>
                                </tr>
                            </thead>
                            <tbody id="dailyConsumedTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="fitness" class="tab-content hidden">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="fitnessTracker">Fitness Tracker</h2>
                    <p class="text-gray-600 mb-4" data-translate="fitnessText">Log je workouts en houd de verbrande calorieën bij.</p>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2" data-translate="addStrengthTraining">Krachttraining toevoegen</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="weight-date" class="block text-gray-700" data-translate="date">Datum</label>
                                <input type="date" id="weight-date" class="w-full p-2 border rounded" required>
                            </div>
                            <div>
                                <label for="weight-exercise-name" class="block text-gray-700" data-translate="exercise">Oefening</label>
                                <input type="text" id="weight-exercise-name" class="w-full p-2 border rounded" data-translate-placeholder="exercisePlaceholder" placeholder="Naam van de oefening" required>
                            </div>
                            <div id="sets-container" class="space-y-2">
                                <label class="block text-gray-700" data-translate="sets">Sets</label>
                                <div class="flex gap-2 set-row">
                                    <input type="number" placeholder="Gewicht (kg)" min="1" step="0.1" class="flex-grow p-2 border rounded" data-translate-placeholder="weightPlaceholder">
                                    <input type="number" placeholder="Herhalingen" min="1" class="flex-grow p-2 border rounded" data-translate-placeholder="repsPlaceholder">
                                </div>
                            </div>
                            <button id="add-set-btn" class="bg-gray-300 text-gray-800 p-2 rounded w-full hover:bg-gray-400" data-translate="addSet">Set toevoegen</button>
                            <div>
                                <label for="weight-notes" class="block text-gray-700" data-translate="notes">Notities (optioneel)</label>
                                <textarea id="weight-notes" class="w-full p-2 border rounded" data-translate-placeholder="notesPlaceholder" placeholder="Bijv. Ik voelde me vandaag sterk."></textarea>
                            </div>
                            <button id="log-weight-btn" class="bg-blue-500 text-white p-2 rounded w-full hover:bg-blue-600" data-translate="save">Opslaan</button>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2" data-translate="cardio">Cardio</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="cardio-date" class="block text-gray-700" data-translate="date">Datum</label>
                                <input type="date" id="cardio-date" class="w-full p-2 border rounded" required>
                            </div>
                            <div>
                                <label for="cardio-activity" class="block text-gray-700" data-translate="chooseActivity">Kies activiteit...</label>
                                <select id="cardio-activity" class="w-full p-2 border rounded" required>
                                    <option value="" disabled selected data-translate="chooseActivity">Kies activiteit...</option>
                                    <option value="running" data-translate="running">Hardlopen</option>
                                    <option value="walking" data-translate="walking">Wandelen</option>
                                    <option value="cycling" data-translate="cycling">Fietsen</option>
                                    <option value="elliptical" data-translate="elliptical">Crosstrainer</option>
                                    <option value="rowing" data-translate="rowing">Roeien</option>
                                    <option value="swimming" data-translate="swimming">Zwemmen</option>
                                </select>
                            </div>
                            <div>
                                <label for="cardio-duration" class="block text-gray-700" data-translate="duration">Duur (minuten)</label>
                                <input type="number" id="cardio-duration" class="w-full p-2 border rounded" data-translate-placeholder="durationPlaceholder" placeholder="Duur (minuten)" min="1" required>
                            </div>
                            <div>
                                <label for="cardio-distance" class="block text-gray-700" data-translate="distance">Afstand (km)</label>
                                <input type="number" id="cardio-distance" class="w-full p-2 border rounded" data-translate-placeholder="distancePlaceholder" placeholder="Afstand (km)" step="0.1" min="0.1">
                            </div>
                            <button id="log-cardio-btn" class="bg-blue-500 text-white p-2 rounded w-full hover:bg-blue-600" data-translate="addCardio">Cardio Toevoegen</button>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-2" data-translate="manualCalorieBurn">Handmatige Calorieën Verbranden</h3>
                        <p class="text-gray-600 mb-4" data-translate="manualBurnText">Handmatig verbrande calorieën toevoegen, bijvoorbeeld na een groepsles.</p>
                        <form id="manual-burned-calories-form" class="space-y-4">
                            <div>
                                <label for="manual-burn-date" class="block text-gray-700" data-translate="date">Datum</label>
                                <input type="date" id="manual-burn-date" class="w-full p-2 border rounded" required>
                            </div>
                            <div>
                                <label for="manual-burn-amount" class="block text-gray-700" data-translate="burnedAmount">Verbrande Calorieën (kcal)</label>
                                <input type="number" id="manual-burn-amount" class="w-full p-2 border rounded" data-translate-placeholder="burnedAmountPlaceholder" placeholder="Bijv. 350" min="1" required>
                            </div>
                            <button type="submit" class="bg-blue-500 text-white p-2 rounded w-full hover:bg-blue-600" data-translate="logBurn">Verbranding Loggen</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="metingen" class="tab-content hidden">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="measurements">Lichaamsmetingen</h2>
                    <p class="text-gray-600 mb-4" data-translate="measurementsText">Houd je lichaamsmaten bij om je vooruitgang te zien.</p>
                    <form id="measurements-form" class="space-y-4">
                        <div>
                            <label for="measurement-date" class="block text-gray-700" data-translate="date">Datum</label>
                            <input type="date" id="measurement-date" class="w-full p-2 border rounded" required>
                        </div>
                        <div>
                            <label for="measurement-weight" class="block text-gray-700" data-translate="weight">Gewicht (kg)</label>
                            <input type="number" id="measurement-weight" class="w-full p-2 border rounded" data-translate-placeholder="weightKgPlaceholder" placeholder="Gewicht in kg" step="0.1" min="20">
                        </div>
                        <div>
                            <label for="measurement-fat" class="block text-gray-700" data-translate="fatPercentage">Vetpercentage (%)</label>
                            <input type="number" id="measurement-fat" class="w-full p-2 border rounded" data-translate-placeholder="fatPercentagePlaceholder" placeholder="Vetpercentage" step="0.1" min="1">
                        </div>
                        <div>
                            <label for="measurement-water" class="block text-gray-700" data-translate="waterPercentage">Vochtpercentage (%)</label>
                            <input type="number" id="measurement-water" class="w-full p-2 border rounded" data-translate-placeholder="waterPercentagePlaceholder" placeholder="Vochtpercentage" step="0.1" min="1">
                        </div>
                        <div>
                            <label for="measurement-waist" class="block text-gray-700" data-translate="waist">Taille (cm)</label>
                            <input type="number" id="measurement-waist" class="w-full p-2 border rounded" data-translate-placeholder="waistPlaceholder" placeholder="Omtrek" step="0.1" min="1">
                        </div>
                        <div>
                            <label for="measurement-hip" class="block text-gray-700" data-translate="hip">Heup (cm)</label>
                            <input type="number" id="measurement-hip" class="w-full p-2 border rounded" data-translate-placeholder="hipPlaceholder" placeholder="Omtrek" step="0.1" min="1">
                        </div>
                        <div>
                            <label for="measurement-buttocks" class="block text-gray-700" data-translate="buttocks">Poep (cm)</label>
                            <input type="number" id="measurement-buttocks" class="w-full p-2 border rounded" data-translate-placeholder="buttocksPlaceholder" placeholder="Omtrek" step="0.1" min="1">
                        </div>
                        <button type="submit" class="bg-blue-500 text-white p-2 rounded w-full mt-4 hover:bg-blue-600" data-translate="saveMeasurements">Metingen Opslaan</button>
                    </form>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-2" data-translate="yourHistory">Jouw Historie</h3>
                        <p class="text-sm text-gray-500 mb-4" data-translate="noMeasurementsText" id="no-measurements-text">Nog geen metingen opgeslagen.</p>
                        <div class="table-container overflow-x-auto">
                            <table class="min-w-full bg-white border-collapse" id="measurements-list">
                                <thead>
                                    <tr class="bg-gray-200">
                                        <th class="py-2 px-4 border text-left" data-translate="date">Datum</th>
                                        <th class="py-2 px-4 border text-left" data-translate="weight">Gewicht</th>
                                        <th class="py-2 px-4 border text-left" data-translate="fat">Vet %</th>
                                        <th class="py-2 px-4 border text-left" data-translate="water">Vocht %</th>
                                        <th class="py-2 px-4 border text-left" data-translate="waist">Taille</th>
                                        <th class="py-2 px-4 border text-left" data-translate="hip">Heup</th>
                                        <th class="py-2 px-4 border text-left" data-translate="buttocks">Poep</th>
                                    </tr>
                                </thead>
                                <tbody id="measurements-table-body">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="history" class="tab-content hidden">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="dailyLogs">Dagelijkse Logboeken</h2>
                    <p class="text-gray-600 mb-4" data-translate="dailyLogsText">Een overzicht van al je activiteiten.</p>
                    <div id="log-list" class="space-y-4">
                        <p class="text-center text-gray-500" data-translate="noHistoryText">Nog geen logboeken beschikbaar.</p>
                    </div>
                </div>
            </div>
            
            <div id="agenda" class="tab-content hidden">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4" data-translate="trainingLogs">Trainingslogboeken</h2>
                    <p class="text-gray-600 mb-4" data-translate="trainingLogsText">Een overzicht van al je krachttraining en cardio sessies.</p>
                    <div class="table-container overflow-x-auto">
                        <table class="min-w-full bg-white border-collapse" id="training-history">
                            <thead>
                                <tr class="bg-gray-200">
                                    <th class="py-2 px-4 border text-left" data-translate="date">Datum</th>
                                    <th class="py-2 px-4 border text-left" data-translate="exercise">Oefening</th>
                                    <th class="py-2 px-4 border text-left" data-translate="reps">Herh.</th>
                                    <th class="py-2 px-4 border text-left" data-translate="sets">Sets</th>
                                    <th class="py-2 px-4 border text-left" data-translate="activity">Activiteit</th>
                                    <th class="py-2 px-4 border text-left" data-translate="duration">Duur</th>
                                    <th class="py-2 px-4 border text-left" data-translate="distance">Afstand</th>
                                </tr>
                            </thead>
                            <tbody id="trainingHistoryTableBody">
                                </tbody>
                        </table>
                    </div>
                    <p class="text-sm text-gray-500 mt-4" data-translate="noTrainingHistoryText" id="no-training-history-text">Nog geen trainingslogboeken.</p>
                </div>
            </div>
        </main>
    </div>
    
    <div id="modal" class="modal-overlay hidden">
        <div class="modal-content">
            <p class="modal-message" id="modal-message"></p>
            <button id="modal-close-btn" class="bg-blue-500 text-white p-2 rounded" data-translate="close">Sluiten</button>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, orderBy, limit, getDocs, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Stap 1: Firebase-configuratie en -initialisatie
        const firebaseConfig = {
            apiKey: "AIzaSyDWlRgSuD25KDBlMvtv5_7Cun_RhjLUIFo",
            authDomain: "nutriscan-b3449.firebaseapp.com",
            projectId: "nutriscan-b3449",
            storageBucket: "nutriscan-b3449.appspot.com",
            messagingSenderId: "1033379364886",
            appId: "1:1033379364886:web:6e1c070f64c1c91104e1c7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Globale variabelen en DOM-elementen
        let userProfileData = {};
        let currentLanguage = 'nl';
        const translations = {
            nl: {
                title: "NutriScan",
                quote: "\"Your body can stand almost anything. It’s your mind that you have to convince\"",
                tab: {
                    dashboard: "Dashboard",
                    profile: "Profiel",
                    calories: "Calorieën",
                    fitness: "Fitness",
                    agenda: "Agenda",
                    measurements: "Metingen",
                    history: "Geschiedenis"
                },
                dailyOverview: "Overzicht Vandaag",
                bmi: "BMI",
                dailyGoal: "Dagelijks Doel (kcal)",
                timeToGoal: "Haalbaar In (weken)",
                consumed: "Verbruikt: ",
                burned: "Verbrand: ",
                netCalories: "Netto Calorieën: ",
                goalToday: "Doel voor vandaag",
                yourDailyGoal: "Jouw Dagelijks Doel:",
                netCaloriesToday: "Netto Calorieën:",
                caloriesRemaining: "Calorieën Over:",
                weightProgress: "Gewichtsvoortgang",
                current: "Huidig:",
                target: "Doel:",
                personalInfo: "Persoonlijke Gegevens",
                language: "Taal",
                lang_nl: "Nederlands",
                lang_fr: "Français",
                gender: "Geslacht",
                male: "Man",
                female: "Vrouw",
                height: "Lengte (cm)",
                age: "Leeftijd",
                currentWeight: "Huidig Gewicht (kg)",
                targetWeight: "Streefgewicht (kg)",
                activityFactor: "Activiteitsfactor",
                activity: {
                    sedentary: "Zittend werk",
                    light: "Licht actief (1-3x/week sport)",
                    moderate: "Gemiddeld actief (3-5x/week sport)",
                    veryActive: "Zeer actief (6-7x/week sport)",
                    extreme: "Extreem actief (zwaar werk + 2x sport)"
                },
                weightGoal: "Wat zou u willen?",
                maintainWeight: "Gewicht behouden",
                loseWeight: "Gewicht verliezen",
                gainWeight: "Spieren opbouwen",
                saveAndCalculate: "Opslaan & Berekenen",
                manualEntry: "Handmatige Calorieën Registratie",
                manualEntryText: "Voer het voedingsmiddel en de details in om calorieën toe te voegen.",
                food: "Voedingsmiddel",
                foodPlaceholder: "Bijv. banaan of water",
                grams: "Gewicht (in grammen)",
                gramsPlaceholder: "Bijv. 120",
                liters: "Gewicht (in liters)",
                litersPlaceholder: "Bijv. 0.5",
                caloriesPer100g: "Calorieën per 100g",
                caloriesPer100gPlaceholder: "Bijv. 89",
                caloriesPerLiter: "Calorieën per 1L",
                caloriesPerLiterPlaceholder: "Bijv. 40",
                addCalories: "Voeg Calorieën toe",
                today: "Vandaag",
                totalToday: "Totaal Vandaag:",
                nutritionOverview: "Overzicht Voeding",
                yourHistory: "Jouw Historie",
                noFoodAdded: "Nog geen voedsel toegevoegd vandaag.",
                fitnessTracker: "Fitness Tracker",
                fitnessText: "Log je workouts en houd de verbrande calorieën bij.",
                addStrengthTraining: "Krachttraining toevoegen",
                date: "Datum",
                exercise: "Oefening",
                exercisePlaceholder: "Naam van de oefening",
                sets: "Sets",
                weightPlaceholder: "Gewicht (kg)",
                repsPlaceholder: "Herhalingen",
                addSet: "Set toevoegen",
                notes: "Notities (optioneel)",
                notesPlaceholder: "Bijv. Ik voelde me vandaag sterk.",
                save: "Opslaan",
                cardio: "Cardio",
                chooseActivity: "Kies activiteit...",
                running: "Hardlopen",
                walking: "Wandelen",
                cycling: "Fietsen",
                elliptical: "Crosstrainer",
                rowing: "Roeien",
                swimming: "Zwemmen",
                durationPlaceholder: "Duur (minuten)",
                distancePlaceholder: "Afstand (km)",
                addCardio: "Cardio Toevoegen",
                manualCalorieBurn: "Handmatige Calorieën Verbranden",
                manualBurnText: "Handmatig verbrande calorieën toevoegen, bijvoorbeeld na een groepsles.",
                burnedAmount: "Verbrande Calorieën (kcal)",
                burnedAmountPlaceholder: "Bijv. 350",
                logBurn: "Verbranding Loggen",
                totalBurnedToday: "Totaal Verbrand Vandaag",
                burnedCalories: "Verbrande Calorieën:",
                measurements: "Lichaamsmetingen",
                measurementsText: "Houd je lichaamsmaten bij om je vooruitgang te zien.",
                weight: "Gewicht",
                weightKgPlaceholder: "Gewicht in kg",
                fatPercentage: "Vetpercentage (%)",
                fatPercentagePlaceholder: "Vetpercentage",
                waterPercentage: "Vochtpercentage (%)",
                waterPercentagePlaceholder: "Vochtpercentage",
                waist: "Taille (cm)",
                waistPlaceholder: "Omtrek",
                hip: "Heup (cm)",
                hipPlaceholder: "Omtrek",
                buttocks: "Poep (cm)",
                buttocksPlaceholder: "Omtrek",
                saveMeasurements: "Metingen Opslaan",
                yourHistory: "Jouw Historie",
                noMeasurementsText: "Nog geen metingen opgeslagen.",
                dailyLogs: "Dagelijkse Logboeken",
                dailyLogsText: "Een overzicht van al je activiteiten.",
                noHistoryText: "Nog geen logboeken beschikbaar.",
                close: "Sluiten",
                // Modal berichten
                noData: "Geen gegevens",
                foodAdded: "Toegevoegd: {foodName} ({calories} kcal)",
                enterAllFields: "Vul alle verplichte velden in.",
                errorInit: "Fout: Initialisatie van de database mislukt.",
                errorAddingFood: "Fout bij het toevoegen van voedsel.",
                minWeightEntry: "Vul minimaal een datum, oefening en ten minste één set in.",
                logWeightSuccess: "Krachttraining succesvol gelogd.",
                logWeightError: "Fout bij het loggen van krachttraining.",
                saveProfileSuccess: "Profiel succesvol opgeslagen.",
                saveProfileError: "Fout bij het opslaan van profiel.",
                logCardioSuccess: "Cardio training gelogd. Verbrande calorieën: {calories} kcal.",
                logCardioError: "Fout bij het loggen van cardio training.",
                logBurnSuccess: "Handmatig verbrande calorieën succesvol gelogd: {calories} kcal.",
                logBurnError: "Fout bij het handmatig loggen van calorieën.",
                logTrainingSuccess: "Training succesvol in de agenda opgeslagen.",
                logTrainingError: "Fout bij het opslaan van training.",
                minMeasurementEntry: "Vul minimaal een datum en één meting in.",
                logMeasurementsSuccess: "Metingen succesvol opgeslagen.",
                logMeasurementsError: "Fout bij het opslaan van meting.",
                weightTraining: "Krachttraining",
                cardioTraining: "Cardio",
                plannedTraining: "Geplande training",
                quantity: "Hoeveelheid",
                calories: "Calorieën",
                reps: "Herhalingen",
                duration: "Duur",
                distance: "Afstand",
                "weight-grams": "Gewicht (g)",
                "weight-liters": "Gewicht (L)",
                "calories-per-100g": "Calorieën (100g)",
                "calories-per-liter": "Calorieën (1L)",
                totalCalories: "Totaal (kcal)",
                trainingLogs: "Trainingslogboeken",
                trainingLogsText: "Een overzicht van al je krachttraining en cardio sessies."
            },
            fr: {
                title: "NutriScan",
                quote: "\"Votre corps peut presque tout supporter. C'est votre esprit que vous devez convaincre\"",
                tab: {
                    dashboard: "Tableau de bord",
                    profile: "Profil",
                    calories: "Calories",
                    fitness: "Fitness",
                    agenda: "Agenda",
                    measurements: "Mensurations",
                    history: "Historique"
                },
                dailyOverview: "Aperçu du jour",
                bmi: "IMC",
                dailyGoal: "Objectif quotidien (kcal)",
                timeToGoal: "Temps pour atteindre l'objectif (semaines)",
                consumed: "Consommé: ",
                burned: "Brûlé: ",
                netCalories: "Calories nettes: ",
                goalToday: "Objectif pour aujourd'hui",
                yourDailyGoal: "Votre objectif quotidien:",
                netCaloriesToday: "Calories nettes:",
                caloriesRemaining: "Calories restantes:",
                weightProgress: "Progression du poids",
                current: "Actuel:",
                target: "Cible:",
                personalInfo: "Informations personnelles",
                language: "Langue",
                lang_nl: "Néerlandais",
                lang_fr: "Français",
                gender: "Sexe",
                male: "Homme",
                female: "Femme",
                height: "Taille (cm)",
                age: "Âge",
                currentWeight: "Poids actuel (kg)",
                targetWeight: "Poids cible (kg)",
                activityFactor: "Facteur d'activité",
                activity: {
                    sedentary: "Travail sédentaire",
                    light: "Légèrement actif (1-3x/semaine de sport)",
                    moderate: "Modérément actif (3-5x/semaine de sport)",
                    veryActive: "Très actif (6-7x/semaine de sport)",
                    extreme: "Extrêmement actif (travail lourd + 2x sport)"
                },
                weightGoal: "Que voudriez-vous?",
                maintainWeight: "Maintenir le poids",
                loseWeight: "Perdre du poids",
                gainWeight: "Prendre du muscle",
                saveAndCalculate: "Enregistrer & Calculer",
                manualEntry: "Saisie manuelle des calories",
                manualEntryText: "Entrez les aliments et les détails pour ajouter des calories.",
                food: "Aliment",
                foodPlaceholder: "Ex. banane ou eau",
                grams: "Poids (en grammes)",
                gramsPlaceholder: "Ex. 120",
                liters: "Poids (en litres)",
                litersPlaceholder: "Ex. 0.5",
                caloriesPer100g: "Calories pour 100g",
                caloriesPer100gPlaceholder: "Ex. 89",
                caloriesPerLiter: "Calories pour 1L",
                caloriesPerLiterPlaceholder: "Ex. 40",
                addCalories: "Ajouter des calories",
                today: "Aujourd'hui",
                totalToday: "Total aujourd'hui:",
                nutritionOverview: "Aperçu de la nutrition",
                yourHistory: "Votre historique",
                noFoodAdded: "Aucun aliment ajouté aujourd'hui.",
                fitnessTracker: "Suivi de fitness",
                fitnessText: "Enregistrez vos entraînements en suivez les calories brûlées.",
                addStrengthTraining: "Ajouter de la musculation",
                date: "Date",
                exercise: "Exercice",
                exercisePlaceholder: "Nom de l'exercice",
                sets: "Séries",
                weightPlaceholder: "Poids (kg)",
                repsPlaceholder: "Répétitions",
                addSet: "Ajouter une série",
                notes: "Notes (optionnel)",
                notesPlaceholder: "Ex. Je me sentais fort aujourd'hui.",
                save: "Enregistrer",
                cardio: "Cardio",
                chooseActivity: "Choisir une activité...",
                running: "Course à pied",
                walking: "Marche",
                cycling: "Vélo",
                elliptical: "Vélo elliptique",
                rowing: "Aviron",
                swimming: "Nage",
                durationPlaceholder: "Durée (minuten)",
                distancePlaceholder: "Afstand (km)",
                addCardio: "Ajouter du cardio",
                manualCalorieBurn: "Calories brûlées manuellement",
                manualBurnText: "Ajouter manuellement les calories brûlées, par voorbeeld après een cours collectif.",
                burnedAmount: "Calories brûlées (kcal)",
                burnedAmountPlaceholder: "Ex. 350",
                logBurn: "Enregistrer les calories brûlées",
                totalBurnedToday: "Total brûlé aujourd'hui",
                burnedCalories: "Calories brûlées:",
                measurements: "Mensurations corporelles",
                measurementsText: "Suivez vos mensurations corporelles voor voir vos progrès.",
                weight: "Poids",
                weightKgPlaceholder: "Poids en kg",
                fatPercentage: "Pourcentage de graisse (%)",
                fatPercentagePlaceholder: "Pourcentage de graisse",
                waterPercentage: "Pourcentage d'eau (%)",
                waterPercentagePlaceholder: "Pourcentage d'eau",
                waist: "Taille (cm)",
                waistPlaceholder: "Tour de taille",
                hip: "Hanche (cm)",
                hipPlaceholder: "Tour de hanche",
                buttocks: "Fessier (cm)",
                buttocksPlaceholder: "Tour de fessier",
                saveMeasurements: "Enregistrer les mensurations",
                yourHistory: "Votre historique",
                noMeasurementsText: "Aucune mesure enregistrée.",
                dailyLogs: "Journaux quotidiens",
                dailyLogsText: "Un aperçu de toutes vos activités.",
                noHistoryText: "Aucun journal disponible.",
                close: "Fermer",
                // Modal messages
                noData: "Pas de données",
                foodAdded: "Ajouté: {foodName} ({calories} kcal)",
                enterAllFields: "Veuillez remplir tous les champs obligatoires.",
                errorInit: "Erreur: L'initialisation de la base de données a échoué.",
                errorAddingFood: "Erreur lors de l'ajout d'aliments.",
                minWeightEntry: "Veuillez entrer au moins une date, un exercice et au moins une série.",
                logWeightSuccess: "Musculation enregistrée avec succès.",
                logWeightError: "Erreur lors de l'enregistrement de la musculation.",
                saveProfileSuccess: "Profil enregistré avec succès.",
                saveProfileError: "Erreur lors de l'enregistrement du profil.",
                logCardioSuccess: "Entraînement cardio enregistré. Calories brûlées: {calories} kcal.",
                logCardioError: "Erreur lors de l'enregistrement de l'entraînement cardio.",
                logBurnSuccess: "Calories brûlées manuellement enregistrées avec succès: {calories} kcal.",
                logBurnError: "Erreur lors de l'enregistrement des calories manuellement.",
                logTrainingSuccess: "Entraînement enregistré avec succès dans l'agenda.",
                logTrainingError: "Erreur lors de l'enregistrement de l'entraînement.",
                minMeasurementEntry: "Veuillez entrer au moins une date en een mesure.",
                logMeasurementsSuccess: "Mensurations enregistrées avec succès.",
                logMeasurementsError: "Erreur lors de l'enregistrement des mensurations.",
                weightTraining: "Musculation",
                cardioTraining: "Cardio",
                plannedTraining: "Entraînement planifié",
                quantity: "Quantité",
                calories: "Calories",
                reps: "Répétitions",
                duration: "Durée",
                distance: "Afstand",
                "weight-grams": "Poids (g)",
                "weight-liters": "Poids (L)",
                "calories-per-100g": "Calorieën (100g)",
                "calories-per-liter": "Calorieën (1L)",
                totalCalories: "Totaal (kcal)",
                trainingLogs: "Journaux d'entraînement",
                trainingLogsText: "Un aperçu de toutes vos séances de musculation et de cardio."
            }
        };

        const localFoodDatabase = {
            'banaan': { 'caloriesPer100g': 89 },
            'appel': { 'caloriesPer100g': 52 },
            'water': { 'caloriesPerLiter': 0 },
            'kipfilet': { 'caloriesPer100g': 165 },
            'rijst': { 'caloriesPer100g': 130 },
            'zalm': { 'caloriesPer100g': 208 }
        };

        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const profileForm = document.getElementById('profile-form');
        const bmiResult = document.getElementById('bmi-result');
        const bmiStatus = document.getElementById('bmi-status');
        const dailyCalorieGoalEl = document.getElementById('daily-calorie-goal');
        const timeToGoalEl = document.getElementById('time-to-goal');
        const consumedCaloriesDisplay = document.getElementById('consumed-calories-display');
        const burnedCaloriesDisplay = document.getElementById('burned-calories-display');
        const netCaloriesDisplay = document.getElementById('net-calories-display');
        const netCaloriesTodayDisplay = document.getElementById('net-calories-today-display');
        const logList = document.getElementById('log-list');
        const weightDate = document.getElementById('weight-date');
        const weightExerciseName = document.getElementById('weight-exercise-name');
        const weightNotes = document.getElementById('weight-notes');
        const setsContainer = document.getElementById('sets-container');
        const logWeightBtn = document.getElementById('log-weight-btn');
        const cardioDate = document.getElementById('cardio-date');
        const cardioActivity = document.getElementById('cardio-activity');
        const cardioDuration = document.getElementById('cardio-duration');
        const cardioDistance = document.getElementById('cardio-distance');
        const logCardioBtn = document.getElementById('log-cardio-btn');
        const dailyBurnedCalories = document.getElementById('daily-burned-calories');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const currentWeightDisplay = document.getElementById('current-weight-display');
        const targetWeightDisplay = document.getElementById('target-weight-display');
        const dailyGoalDisplay = document.getElementById('daily-goal-display');
        const caloriesRemainingDisplay = document.getElementById('calories-remaining-display');
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const measurementsForm = document.getElementById('measurements-form');
        const measurementsList = document.getElementById('measurements-list');
        const measurementsTableBody = document.getElementById('measurements-table-body');
        const noMeasurementsText = document.getElementById('no-measurements-text');
        const addSetBtn = document.getElementById('add-set-btn');
        const dailyConsumedTableBody = document.getElementById('dailyConsumedTableBody');
        const noFoodText = document.getElementById('no-food-text');
        const trainingHistoryTableBody = document.getElementById('trainingHistoryTableBody');
        const noTrainingHistoryText = document.getElementById('no-training-history-text');
        const foodInput = document.getElementById('foodInput');
        const foodSuggestions = document.getElementById('food-suggestions');
        const gramsInputContainer = document.getElementById('grams-input-container');
        const gramsInput = document.getElementById('gramsInput');
        const litersInputContainer = document.getElementById('liters-input-container');
        const litersInput = document.getElementById('litersInput');
        const calsPer100gContainer = document.getElementById('cals-per-100g-container');
        const caloriesPer100gInput = document.getElementById('caloriesPer100gInput');
        const calsPerLiterContainer = document.getElementById('cals-per-liter-container');
        const caloriesPerLiterInput = document.getElementById('caloriesPerLiterInput');
        const addCaloriesButton = document.getElementById('addCaloriesButton');
        const resultDisplay = document.getElementById('resultDisplay');
        const languageSelect = document.getElementById('language-select');
        const manualBurnedCaloriesForm = document.getElementById('manual-burned-calories-form');
        
        let userProfileRef, dailyLogRef, consumedItemsCollectionRef, trainingLogsCollectionRef, measurementsCollectionRef;

        // Stap 2: Definieer je logicafuncties
        function showModal(messageKey, ...params) {
            let message = translations[currentLanguage][messageKey] || messageKey;
            params.forEach((param) => {
                const key = Object.keys(param)[0];
                const value = Object.values(param)[0];
                message = message.replace(`{${key}}`, value);
            });
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        function calculateBmi(height, weight) {
            if (!height || !weight || height <= 0 || weight <= 0) return { bmi: 0, status: "" };
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            let status;
            if (bmi < 18.5) {
                status = "Ondergewicht";
            } else if (bmi >= 18.5 && bmi < 25) {
                status = "Gezond gewicht";
            } else if (bmi >= 25 && bmi < 30) {
                status = "Overgewicht";
            } else {
                status = "Obesitas";
            }
            const statusTranslations = {
                "Ondergewicht": { nl: "Ondergewicht", fr: "Sous-poids" },
                "Gezond gewicht": { nl: "Gezond gewicht", fr: "Poids normal" },
                "Overgewicht": { nl: "Overgewicht", fr: "Surpoids" },
                "Obesitas": { nl: "Obesitas", fr: "Obésité" }
            };
            return { bmi: bmi.toFixed(1), status: statusTranslations[status][currentLanguage] || status };
        }

        function calculateBmr(gender, height, weight, age) {
            if (!gender || !height || !weight || !age) return 0;
            if (gender === 'male') {
                return 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
            } else {
                return 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
            }
        }

        function calculateDailyGoal(weight, bmr, pal, weightGoal) {
            if (!weight || !bmr || !pal || !weightGoal) return { goal: 0, time: 0 };
            const maintenanceCalories = bmr * parseFloat(pal);
            let goalCalories = 0;
            let timeInWeeks = 0;
            if (weightGoal === 'lose') {
                goalCalories = maintenanceCalories - 500;
                const caloriesPerKg = 7700;
                const dailyDeficit = 500;
                const weightDiff = weight - userProfileData.targetWeight;
                if (weightDiff > 0) {
                    timeInWeeks = (weightDiff * caloriesPerKg) / (dailyDeficit * 7);
                } else {
                    timeInWeeks = 0;
                }
            } else if (weightGoal === 'gain') {
                goalCalories = maintenanceCalories + 250;
                timeInWeeks = 0;
            } else {
                goalCalories = maintenanceCalories;
                timeInWeeks = 0;
            }
            return {
                goal: Math.max(0, Math.round(goalCalories)),
                time: Math.round(timeInWeeks)
            };
        }

        function updateProgress(currentWeight, initialWeight, targetWeight) {
            if (!initialWeight || !targetWeight || !currentWeight) return;
            let progress = 0;
            const isLosingWeight = initialWeight > targetWeight;
            if (isLosingWeight) {
                const totalChange = initialWeight - targetWeight;
                const achievedChange = initialWeight - currentWeight;
                if (totalChange > 0) {
                    progress = (achievedChange / totalChange) * 100;
                }
            } else {
                const totalChange = targetWeight - initialWeight;
                const achievedChange = currentWeight - initialWeight;
                if (totalChange > 0) {
                    progress = (achievedChange / totalChange) * 100;
                }
            }
            progress = Math.min(100, Math.max(0, progress));
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}%`;
        }

        function updateUIWithProfileData(data) {
            document.getElementById('gender').value = data.gender || '';
            document.getElementById('height').value = data.height || '';
            document.getElementById('age').value = data.age || '';
            document.getElementById('current-weight').value = data.currentWeight || '';
            document.getElementById('target-weight').value = data.targetWeight || '';
            document.getElementById('activity-factor').value = data.activityFactor || '1.2';
            document.getElementById('weight-goal').value = data.weightGoal || 'maintain';
            currentLanguage = data.language || 'nl';
            languageSelect.value = currentLanguage;
            translatePage(currentLanguage);
            currentWeightDisplay.textContent = `${translations[currentLanguage].current} ${data.currentWeight || 0} kg`;
            targetWeightDisplay.textContent = `${translations[currentLanguage].target} ${data.targetWeight || 0} kg`;
            if (data.height && data.currentWeight) {
                const { bmi, status } = calculateBmi(data.height, data.currentWeight);
                bmiResult.textContent = bmi;
                bmiStatus.textContent = status;
            } else {
                bmiResult.textContent = translations[currentLanguage].noData;
                bmiStatus.textContent = "";
            }
            if (data.gender && data.height && data.currentWeight && data.age && data.targetWeight) {
                const bmr = calculateBmr(data.gender, data.height, data.currentWeight, data.age);
                const { goal, time } = calculateDailyGoal(data.currentWeight, bmr, data.activityFactor, data.weightGoal);
                dailyCalorieGoalEl.textContent = goal;
                dailyGoalDisplay.textContent = `${goal} kcal`;
                timeToGoalEl.textContent = time;
                updateProgress(data.currentWeight, data.initialWeight, data.targetWeight);
            } else {
                dailyCalorieGoalEl.textContent = '0';
                dailyGoalDisplay.textContent = '0 kcal';
                timeToGoalEl.textContent = '0';
                progressFill.style.width = '0%';
                progressText.textContent = '0%';
            }
        }

        function updateUIWithDailyLog(data) {
            const consumed = data.consumedCalories || 0;
            const burned = data.burnedCalories || 0;
            const net = consumed - burned;
            consumedCaloriesDisplay.textContent = `${translations[currentLanguage].consumed}${consumed} kcal`;
            burnedCaloriesDisplay.textContent = `${translations[currentLanguage].burned}${burned} kcal`;
            netCaloriesDisplay.textContent = `${net} kcal`;
            netCaloriesTodayDisplay.textContent = `${net} kcal`;
            dailyBurnedCalories.textContent = `${burned} kcal`;
            updateRemainingCalories();
        }

        function updateRemainingCalories() {
            const dailyGoal = parseInt(dailyCalorieGoalEl.textContent) || 0;
            const consumed = parseInt(consumedCaloriesDisplay.textContent.match(/\d+/)?.[0] || 0);
            const burned = parseInt(burnedCaloriesDisplay.textContent.match(/\d+/)?.[0] || 0);
            const remaining = dailyGoal - (consumed - burned);
            caloriesRemainingDisplay.textContent = `${remaining} kcal`;
            caloriesRemainingDisplay.classList.toggle('text-red-600', remaining < 0);
            caloriesRemainingDisplay.classList.toggle('text-green-600', remaining >= 0);
        }

        function toggleFoodInputFields(isLiquid) {
            gramsInputContainer.classList.toggle('hidden', isLiquid);
            calsPer100gContainer.classList.toggle('hidden', isLiquid);
            litersInputContainer.classList.toggle('hidden', !isLiquid);
            calsPerLiterContainer.classList.toggle('hidden', !isLiquid);
            if (isLiquid) {
                gramsInput.value = '';
                caloriesPer100gInput.value = '';
            } else {
                litersInput.value = '';
                caloriesPerLiterInput.value = '';
            }
        }
        
        function getTodayDate() {
            return new Date().toISOString().slice(0, 10);
        }

        async function getTodaysConsumedItems() {
            const today = getTodayDate();
            if (!consumedItemsCollectionRef) return [];
            const q = query(consumedItemsCollectionRef, where('date', '==', today), orderBy('timestamp', 'asc'));
            try {
                const querySnapshot = await getDocs(q);
                return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            } catch (e) {
                console.error("Fout bij het ophalen van de dagelijkse lijst: ", e);
                return [];
            }
        }

        async function renderDailyConsumedItems() {
            const items = await getTodaysConsumedItems();
            dailyConsumedTableBody.innerHTML = '';
            const tableContainer = document.querySelector('#daily-nutrition-overview .table-container');
            if (items.length > 0) {
                if(tableContainer) tableContainer.style.display = 'block';
                noFoodText.style.display = 'none';
                items.forEach((item) => {
                    const row = document.createElement('tr');
                    const getValue = (key) => {
                        const value = item[key];
                        return (value === null || typeof value === 'undefined') ? '—' : value;
                    };
                    row.innerHTML = `
                        <td>${getValue('date')}</td>
                        <td>${getValue('name')}</td>
                        <td>${getValue('grams') !== '—' ? getValue('grams') + ' g' : '—'}</td>
                        <td>${getValue('liters') !== '—' ? getValue('liters') + ' L' : '—'}</td>
                        <td>${getValue('calories') !== '—' ? getValue('calories') + ' kcal' : '—'}</td>
                    `;
                    dailyConsumedTableBody.appendChild(row);
                });
            } else {
                if(tableContainer) tableContainer.style.display = 'none';
                noFoodText.style.display = 'block';
            }
        }

        async function addConsumedItemToLog(foodName, quantity, calories, calsPerUnit, isLiquid) {
            try {
                if (dailyLogRef && consumedItemsCollectionRef) {
                    const docSnap = await getDoc(dailyLogRef);
                    const currentData = docSnap.exists() ? docSnap.data() : { consumedCalories: 0, burnedCalories: 0 };
                    const newConsumed = (currentData.consumedCalories || 0) + parseFloat(calories);
                    const today = getTodayDate();
                    await setDoc(dailyLogRef, { consumedCalories: newConsumed, date: today }, { merge: true });
                    const newConsumedItem = {
                        name: foodName,
                        grams: isLiquid ? null : quantity,
                        liters: isLiquid ? quantity : null,
                        calories: parseFloat(calories),
                        caloriesPer100g: isLiquid ? null : calsPerUnit,
                        caloriesPerLiter: isLiquid ? calsPerUnit : null,
                        date: today,
                        timestamp: new Date().toISOString()
                    };
                    await setDoc(doc(consumedItemsCollectionRef), newConsumedItem);
                    const foodDocRef = doc(db, 'foodDatabase', foodName.toLowerCase());
                    if (isLiquid) {
                         await setDoc(foodDocRef, { caloriesPerLiter: calsPerUnit }, { merge: true });
                    } else {
                        await setDoc(foodDocRef, { caloriesPer100g: calsPerUnit }, { merge: true });
                    }
                    showModal('foodAdded', { foodName }, { calories });
                    renderDailyConsumedItems();
                } else {
                    showModal('errorInit');
                }
            } catch (e) {
                console.error("Fout bij het toevoegen van calorieën: ", e);
                showModal('errorAddingFood');
            }
        }

        async function loadMeasurements() {
            try {
                if (!measurementsCollectionRef) return;
                const q = query(measurementsCollectionRef, orderBy("date", "desc"));
                const querySnapshot = await getDocs(q);
                measurementsTableBody.innerHTML = '';
                const tableContainer = document.querySelector('#measurements-list .table-container');
                if (querySnapshot.empty) {
                    if (tableContainer) tableContainer.style.display = 'none';
                    noMeasurementsText.style.display = 'block';
                    return;
                }
                if (tableContainer) tableContainer.style.display = 'block';
                noMeasurementsText.style.display = 'none';
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    const getValue = (key) => {
                        const value = data[key];
                        if (value === null || typeof value === 'undefined') {
                            return '—';
                        }
                        return value;
                    };
                    row.innerHTML = `
                        <td>${getValue('date')}</td>
                        <td>${getValue('weight') !== '—' ? getValue('weight') + ' kg' : '—'}</td>
                        <td>${getValue('fat') !== '—' ? getValue('fat') + ' %' : '—'}</td>
                        <td>${getValue('water') !== '—' ? getValue('water') + ' %' : '—'}</td>
                        <td>${getValue('waist') !== '—' ? getValue('waist') + ' cm' : '—'}</td>
                        <td>${getValue('hip') !== '—' ? getValue('hip') + ' cm' : '—'}</td>
                        <td>${getValue('buttocks') !== '—' ? getValue('buttocks') + ' cm' : '—'}</td>
                    `;
                    measurementsTableBody.appendChild(row);
                });
            } catch (e) {
                console.error("Fout bij het laden van metingen:", e);
                const tableContainer = document.querySelector('#measurements-list .table-container');
                if (tableContainer) tableContainer.style.display = 'none';
                noMeasurementsText.style.display = 'block';
            }
        }

        function showTab(tabId) {
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            const selectedTabButton = document.querySelector(`[data-tab="${tabId}"]`);
            if (selectedTabButton) {
                selectedTabButton.classList.add('active');
            }
            const selectedTabContent = document.getElementById(tabId);
            if (selectedTabContent) {
                selectedTabContent.classList.remove('hidden');
            }
            if (tabId === 'metingen') {
                loadMeasurements();
            } else if (tabId === 'history') {
                loadHistory();
            } else if (tabId === 'agenda') {
                loadTrainingHistory();
            } else if (tabId === 'calories') {
                renderDailyConsumedItems();
            }
        }

        async function loadTrainingHistory() {
            try {
                if (!trainingLogsCollectionRef) return;
                const q = query(trainingLogsCollectionRef, orderBy("date", "desc"));
                const querySnapshot = await getDocs(q);
                trainingHistoryTableBody.innerHTML = '';
                const tableContainer = document.querySelector('#training-history .table-container');
                if (querySnapshot.empty) {
                    if (tableContainer) tableContainer.style.display = 'none';
                    noTrainingHistoryText.style.display = 'block';
                    return;
                }
                if (tableContainer) tableContainer.style.display = 'block';
                noTrainingHistoryText.style.display = 'none';
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    const isCardio = data.type === 'cardio';
                    const getValue = (key) => {
                        const value = data[key];
                        return (value === null || typeof value === 'undefined' || value === '') ? '—' : value;
                    };
                    let setsDisplay = '—';
                    let repsDisplay = '—';
                    if (data.sets && data.sets.length > 0) {
                        setsDisplay = data.sets.length;
                        repsDisplay = data.sets.map(s => s.reps).join(', ');
                    }
                    row.innerHTML = `
                        <td>${getValue('date')}</td>
                        <td>${getValue('exercise') ? getValue('exercise') : '—'}</td>
                        <td>${repsDisplay}</td>
                        <td>${setsDisplay}</td>
                        <td>${isCardio ? translations[currentLanguage][data.activity] || data.activity : '—'}</td>
                        <td>${isCardio ? getValue('duration') + ' min' : '—'}</td>
                        <td>${isCardio ? getValue('distance') + ' km' : '—'}</td>
                    `;
                    trainingHistoryTableBody.appendChild(row);
                });
            } catch (e) {
                console.error("Fout bij het laden van trainingshistorie:", e);
                const tableContainer = document.querySelector('#training-history .table-container');
                if (tableContainer) tableContainer.style.display = 'none';
                noTrainingHistoryText.style.display = 'block';
            }
        }

        async function loadHistory() {
            try {
                if (!auth.currentUser) return;
                const dailyLogsCollectionRef = collection(db, `users/${auth.currentUser.uid}/dailyLogs`);
                const q = query(dailyLogsCollectionRef, orderBy("date", "desc"), limit(7));
                const querySnapshot = await getDocs(q);
                logList.innerHTML = '';
                if (querySnapshot.empty) {
                    logList.innerHTML = `<p class="text-center text-gray-500" id="no-history-text">${translations[currentLanguage].noHistoryText}</p>`;
                } else {
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const div = document.createElement('div');
                        div.classList.add('card', 'mb-2');
                        div.innerHTML = `
                            <p class="font-bold">${data.date}</p>
                            <p>${translations[currentLanguage].consumed}${data.consumedCalories || 0} kcal</p>
                            <p>${translations[currentLanguage].burned}${data.burnedCalories || 0} kcal</p>
                        `;
                        logList.appendChild(div);
                    });
                }
            } catch (e) {
                console.error("Fout bij het laden van geschiedenis:", e);
                logList.innerHTML = `<p class="text-center text-gray-500">${translations[currentLanguage].noHistoryText}</p>`;
            }
        }
        
        // Hoofd-initialisatiefunctie en event listeners
        document.addEventListener('DOMContentLoaded', async () => {
            showTab('dashboard');
            modalCloseBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            // Start anonieme aanmelding
            signInAnonymously(auth);

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const uid = user.uid;
                    const today = getTodayDate();
                    
                    // Correcte paden naar de Firestore-collecties
                    userProfileRef = doc(db, 'users', uid, 'gebruikersprofielen', 'user_profile');
                    dailyLogRef = doc(db, `users/${uid}/dailyLogs`, today);
                    consumedItemsCollectionRef = collection(db, `users/${uid}/consumedItems`);
                    trainingLogsCollectionRef = collection(db, `users/${uid}/trainingLogs`);
                    measurementsCollectionRef = collection(db, `users/${uid}/measurements`);

                    const lastLoginDate = localStorage.getItem('lastLoginDate');
                    if (lastLoginDate !== today) {
                        await setDoc(dailyLogRef, { consumedCalories: 0, burnedCalories: 0, date: today });
                        localStorage.setItem('lastLoginDate', today);
                    }
                    
                    onSnapshot(userProfileRef, (docSnap) => {
                        if (docSnap.exists()) {
                            userProfileData = docSnap.data();
                        } else {
                            userProfileData = {};
                        }
                        updateUIWithProfileData(userProfileData);
                        updateRemainingCalories();
                    });
                    
                    onSnapshot(dailyLogRef, (docSnap) => {
                        if (docSnap.exists()) {
                            updateUIWithDailyLog(docSnap.data());
                        } else {
                            updateUIWithDailyLog({});
                        }
                    });
                    
                    onSnapshot(consumedItemsCollectionRef, () => {
                        renderDailyConsumedItems();
                    });
                    
                    languageSelect.addEventListener('change', async () => {
                        const newLang = languageSelect.value;
                        if (userProfileRef) {
                            await setDoc(userProfileRef, { language: newLang }, { merge: true });
                        }
                        currentLanguage = newLang;
                        translatePage(newLang);
                    });

                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            showTab(button.dataset.tab);
                        });
                    });

                    addSetBtn.addEventListener('click', () => {
                        const newSetRow = document.createElement('div');
                        newSetRow.classList.add('flex', 'gap-2', 'set-row');
                        newSetRow.innerHTML = `
                            <input type="number" placeholder="Gewicht (kg)" min="1" step="0.1" class="flex-grow p-2 border rounded" data-translate-placeholder="weightPlaceholder">
                            <input type="number" placeholder="Herhalingen" min="1" class="flex-grow p-2 border rounded" data-translate-placeholder="repsPlaceholder">
                        `;
                        setsContainer.appendChild(newSetRow);
                    });
                    
                    addCaloriesButton.addEventListener('click', async () => {
                        const foodName = foodInput.value.trim();
                        const isLiquid = !litersInputContainer.classList.contains('hidden');
                        let quantity, caloriesPerUnit, calculatedCalories;
                        if (isLiquid) {
                            quantity = parseFloat(litersInput.value);
                            caloriesPerUnit = parseFloat(caloriesPerLiterInput.value);
                            calculatedCalories = (quantity * caloriesPerUnit).toFixed(1);
                        } else {
                            quantity = parseFloat(gramsInput.value);
                            caloriesPerUnit = parseFloat(caloriesPer100gInput.value);
                            calculatedCalories = ((quantity / 100) * caloriesPerUnit).toFixed(1);
                        }
                        if (!foodName || isNaN(quantity) || isNaN(caloriesPerUnit)) {
                            showModal('enterAllFields');
                            return;
                        }
                        await addConsumedItemToLog(foodName, quantity, calculatedCalories, caloriesPerUnit, isLiquid);
                        foodInput.value = '';
                        gramsInput.value = '';
                        litersInput.value = '';
                        caloriesPer100gInput.value = '';
                        caloriesPerLiterInput.value = '';
                        renderDailyConsumedItems();
                    });

                    foodInput.addEventListener('input', () => {
                        const foodName = foodInput.value.toLowerCase().trim();
                        const isLiquid = ['water', 'melk', 'sap', 'drank', 'koffie', 'thee'].some(liquid => foodName.includes(liquid));
                        toggleFoodInputFields(isLiquid);
                    });

                    foodInput.addEventListener('input', async () => {
                        const searchTerm = foodInput.value.toLowerCase().trim();
                        if (searchTerm.length > 0) {
                             const suggestions = Object.keys(localFoodDatabase)
                                .filter(foodName => foodName.includes(searchTerm))
                                .slice(0, 5);
                            foodSuggestions.innerHTML = '';
                            if (suggestions.length > 0) {
                                suggestions.forEach(foodName => {
                                    const suggestionDiv = document.createElement('div');
                                    suggestionDiv.textContent = foodName.charAt(0).toUpperCase() + foodName.slice(1);
                                    suggestionDiv.addEventListener('click', () => {
                                        foodInput.value = foodName.charAt(0).toUpperCase() + foodName.slice(1);
                                        const food = localFoodDatabase[foodName];
                                        const isLiquid = !!food.caloriesPerLiter;
                                        toggleFoodInputFields(isLiquid);
                                        if (isLiquid) {
                                            litersInput.value = food.liters || '';
                                            caloriesPerLiterInput.value = food.caloriesPerLiter;
                                        } else {
                                            gramsInput.value = food.grams || '';
                                            caloriesPer100gInput.value = food.caloriesPer100g;
                                        }
                                        foodSuggestions.classList.add('hidden');
                                    });
                                    foodSuggestions.appendChild(suggestionDiv);
                                });
                                foodSuggestions.classList.remove('hidden');
                            } else {
                                foodSuggestions.classList.add('hidden');
                            }
                        } else {
                            foodSuggestions.classList.add('hidden');
                        }
                    });
                    
                    document.addEventListener('click', (e) => {
                        if (!foodInput.contains(e.target) && !foodSuggestions.contains(e.target)) {
                            foodSuggestions.classList.add('hidden');
                        }
                    });

                    profileForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const formData = new FormData(profileForm);
                        const data = {
                            gender: formData.get('gender'),
                            height: parseFloat(formData.get('height')),
                            age: parseInt(formData.get('age')),
                            currentWeight: parseFloat(formData.get('current-weight')),
                            targetWeight: parseFloat(formData.get('target-weight')),
                            activityFactor: parseFloat(formData.get('activity-factor')),
                            weightGoal: formData.get('weight-goal'),
                            language: formData.get('language')
                        };
                        if (!userProfileData.initialWeight && data.currentWeight) {
                            data.initialWeight = data.currentWeight;
                        } else if (userProfileData.initialWeight) {
                            data.initialWeight = userProfileData.initialWeight;
                        }
                        if (userProfileRef) {
                            await setDoc(userProfileRef, data, { merge: true });
                            updateUIWithProfileData(data);
                            showModal('saveProfileSuccess');
                        } else {
                            showModal('saveProfileError');
                        }
                    });

                    logWeightBtn.addEventListener('click', async () => {
                        const date = weightDate.value;
                        const exercise = weightExerciseName.value;
                        const sets = [];
                        document.querySelectorAll('.set-row').forEach(row => {
                            const weight = parseFloat(row.querySelector('input:nth-child(1)').value);
                            const reps = parseInt(row.querySelector('input:nth-child(2)').value);
                            if (weight && reps) {
                                sets.push({ weight, reps });
                            }
                        });
                        const notes = weightNotes.value;
                        if (!date || !exercise || sets.length === 0) {
                            showModal('minWeightEntry');
                            return;
                        }
                        try {
                            const logData = { date, exercise, sets, notes, type: 'strength' };
                            await setDoc(doc(trainingLogsCollectionRef), logData);
                            showModal('logWeightSuccess');
                        } catch (e) {
                            console.error(e);
                            showModal('logWeightError');
                        }
                    });
                    
                    logCardioBtn.addEventListener('click', async () => {
                        const date = cardioDate.value;
                        const activity = cardioActivity.value;
                        const duration = parseFloat(cardioDuration.value);
                        const distance = parseFloat(cardioDistance.value);
                        const bodyWeight = userProfileData.currentWeight;
                        if (!date || !activity || !duration || !bodyWeight) {
                            showModal('enterAllFields');
                            return;
                        }
                        const met = {
                            'hardlopen': 7,
                            'wandelen': 3.5,
                            'fietsen': 8,
                            'crosstrainer': 7,
                            'roeien': 7,
                            'zwemmen': 8
                        };
                        const metValue = met[activity] || 3.5;
                        const burnedCalories = Math.round((metValue * bodyWeight * duration) / 60);
                        try {
                            await setDoc(doc(trainingLogsCollectionRef), { date, activity, duration, distance, burnedCalories, type: 'cardio' });
                            const dailyDocSnap = await getDoc(dailyLogRef);
                            const currentBurned = dailyDocSnap.exists() ? dailyDocSnap.data().burnedCalories || 0 : 0;
                            await setDoc(dailyLogRef, { burnedCalories: currentBurned + burnedCalories }, { merge: true });
                            showModal('logCardioSuccess', { calories: burnedCalories });
                        } catch (e) {
                            console.error(e);
                            showModal('logCardioError');
                        }
                    });

                    manualBurnedCaloriesForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const date = document.getElementById('manual-burn-date').value;
                        const burnedAmount = parseFloat(document.getElementById('manual-burn-amount').value);
                        if (!date || isNaN(burnedAmount)) {
                            showModal('enterAllFields');
                            return;
                        }
                        try {
                            const dailyDocSnap = await getDoc(dailyLogRef);
                            const currentBurned = dailyDocSnap.exists() ? dailyDocSnap.data().burnedCalories || 0 : 0;
                            await setDoc(dailyLogRef, { burnedCalories: currentBurned + burnedAmount }, { merge: true });
                            showModal('logBurnSuccess', { calories: burnedAmount });
                        } catch (e) {
                            console.error(e);
                            showModal('logBurnError');
                        }
                    });
                    
                    measurementsForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const date = document.getElementById('measurement-date').value;
                        const weight = parseFloat(document.getElementById('measurement-weight').value);
                        const fat = parseFloat(document.getElementById('measurement-fat').value);
                        const water = parseFloat(document.getElementById('measurement-water').value);
                        const waist = parseFloat(document.getElementById('measurement-waist').value);
                        const hip = parseFloat(document.getElementById('measurement-hip').value);
                        const buttocks = parseFloat(document.getElementById('measurement-buttocks').value);
                        if (!date || (isNaN(weight) && isNaN(fat) && isNaN(water) && isNaN(waist) && isNaN(hip) && isNaN(buttocks))) {
                            showModal('minMeasurementEntry');
                            return;
                        }
                        const measurementData = { date };
                        if (!isNaN(weight)) measurementData.weight = weight;
                        if (!isNaN(fat)) measurementData.fat = fat;
                        if (!isNaN(water)) measurementData.water = water;
                        if (!isNaN(waist)) measurementData.waist = waist;
                        if (!isNaN(hip)) measurementData.hip = hip;
                        if (!isNaN(buttocks)) measurementData.buttocks = buttocks;
                        try {
                            await setDoc(doc(measurementsCollectionRef), measurementData);
                            showModal('logMeasurementsSuccess');
                            loadMeasurements();
                        } catch (e) {
                            console.error(e);
                            showModal('logMeasurementsError');
                        }
                    });

                } else {
                    console.log("Geen gebruiker is ingelogd. Anoniem aanmelden...");
                    signInAnonymously(auth).catch((error) => {
                        console.error("Fout bij anonieme aanmelding:", error);
                    });
                }
            });
        });
    </script>
</body>
</html>
